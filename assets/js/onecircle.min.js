console.log(" %c Theme onecircle %c https://github.com/gogobody/onecircle","color:#444;background:#eee;padding:5px 0","color:#eee;background:#444;padding:5px");var stripscript=function(e){for(var t=new RegExp("[`^()|{}'\\[\\].<>/?~！……*——|{}‘”“↵\r\n]"),n="",i=0;i<e.length;i++)n+=e.substr(i,1).replace(t,"");return n};$(function(){$('[data-toggle="tooltip"]').tooltip(),$.extend({message:function(e){var t={title:"",message:" 操作成功",time:"3000",type:"success",showClose:!0,autoClose:!0,onClose:function(){}};"string"==typeof e&&(t.message=e),"object"==typeof e&&(t=$.extend({},t,e));var n,i=t.showClose?'<div class="c-message--close">×</div>':"",e=""!==t.title?'<h2 class="c-message__title">'+t.title+"</h2>":"",e='<div class="c-message animated animate__slideInRight"><i class=" c-message--icon c-message--'+t.type+'"></i><div class="el-notification__group">'+e+'<div class="el-notification__content">'+t.message+"</div>"+i+"</div></div>",i=$("body"),a=$(e),o=function(){a.addClass("animate__slideOutRight"),a.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){s()})},s=function(){a.remove(),t.onClose(t),clearTimeout(n)};$(".c-message").remove(),i.append(a),a.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a.removeClass("messageFadeInDown")}),i.on("click",".c-message--close",function(e){o()}),t.autoClose&&(n=setTimeout(function(){o()},t.time))},showloading:function(e){var t=$.extend({},{selector:"header",choice:"append"},e),n='<div class="loading-container"><svg width="120" height="12px" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg" fill="#03A9F5" class="loading-svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle></svg></div>';"string"==typeof t.selector&&(e=$(t.selector),"append"===t.choice?e.append(n):"prepend"===t.choice?e.prepend(n):"after"===t.choice?e.after(n):"before"===t.choice&&e.before(n))},rmloading:function(){$(".loading-container").remove()}})});var indexInput={init:function(){this.loginUserName="",this.addArea=$(".add-area"),this.addAreaBtn=$(".add-area button"),this.addPicBtn=$("#addpic"),this.addLinkBtn=$("#addlink"),this.addVideoBtn=$("#addvideo"),this.addBilibiliBtn=$("#addbilibili"),this.uploadPic=$(".upload-pic"),this.showPanel=$(".show-panel.fbjukw"),this.additionArray=[],this.nowtype="default",this.articleType=$("#articleType"),this.funcInit()},funcInit:function(){this.indexEventInit(),this.login_ajax(),this.searchEventInit(),this.articleClickInit(),this.asideEventInit()},resetInputStatus:function(){this.additionArray=[]},changeType:function(e){this.nowtype!==e&&(this.nowtype=e,this.articleType.val(e),this.resetInputStatus(),$(".add-area input").val(""))},doParseDefaultFunc:function(e,t){$(e).html("解析中");var n,i=$(".add-area input"),a=i.val();checkURL(a)?(n='<div class="sc-AxjAm sc-AxirZ ciIrlj">\n<div class="eHTuZC" style="background-image: url('+a+');">\n<div class="cPHQWG">\n<svg viewBox="0 0 17 17" fill="currentColor">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div>\n</div>',t.showPanel.append(n),t.additionArray.push(a),t.addPicBtn.siblings().addClass("btn-disable"),i.val(""),$(".cPHQWG").unbind("click").bind("click",function(){var e=$(this).parent().css("backgroundImage").replace("url(","").replace(")","");t.additionArray.splice($.inArray(e,t.additionArray),1),$(this).parent().parent().remove(),0===t.additionArray.length&&t.addPicBtn.siblings().removeClass("btn-disable")})):$.message({title:"提示",message:"请输入正确的图片地址",type:"error"}),$(e).html("添加")},doParseLinkFunc:function(n,i){$(n).text("解析中");var a=$(".add-area input").val();checkURL(a)?$.post(gconf.oneaction,{type:"parsemeta",url:a},function(e){var t;e&&((t=$(".sc-AxjAm.kgcKxQ")).css("display","block"),t.attr("href",a),$(".sc-AxjAm.kgcKxQ .hHnMup").html(e),i.additionArray=[],i.additionArray.push(a),i.additionArray.push(stripscript(e)),$(n).text("添加"),i.addLink.siblings().addClass("btn-disable"),$(".sc-AxjAm.sc-AxirZ.ezTcmd").unbind("click").bind("click",function(e){return $(".kgcKxQ").css("display","none"),e.stopPropagation(),i.addLink.siblings().removeClass("btn-disable"),!1})),$(n).text("添加")}):($.message({title:"提示",message:"请输入正确的地址",type:"error"}),$(n).text("添加"))},doParseVideoFunc:function(e,t){var n=$(".add-area input"),i=n.val();checkURL(i)?(t.additionArray.push(i),i='<div class="show-panel-inner"><div class="jLaetV"><div class="hHnMup">'+i+'</div></div>\n<div class="ezTcmd show-close">\n<div class="hyliOy">\n<svg viewBox="0 0 17 17" fill="#ccc">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div></div>',t.showPanel.append(i),t.addVideoBtn.siblings().addClass("btn-disable"),n.val(""),$(".show-close").unbind("click").bind("click",function(){var e=$(this).siblings().text();t.additionArray.splice($.inArray(e,t.additionArray),1),$(this).parent().remove(),0===t.additionArray.length&&t.addVideoBtn.siblings().removeClass("btn-disable")})):$.message({title:"提示",message:"请输入正确的视频地址",type:"error"})},doParseBilibiliFunc:function(e,t){var n=$(".add-area input"),i=n.val();t.additionArray.push(i);i='<div class="show-panel-inner"><div class="jLaetV"><div class="hHnMup">'+i+'</div></div>\n<div class="ezTcmd show-close">\n<div class="hyliOy">\n<svg viewBox="0 0 17 17" fill="#ccc">\n<path d="M9.565 8.595l5.829 5.829a.686.686 0 01-.97.97l-5.83-5.83-5.828 5.83a.686.686 0 01-.97-.97l5.829-5.83-5.83-5.828a.686.686 0 11.97-.97l5.83 5.829 5.829-5.83a.686.686 0 01.97.97l-5.83 5.83z"></path>\n</svg>\n</div>\n</div></div>';t.showPanel.append(i),t.addBilibiliBtn.siblings().addClass("btn-disable"),n.val(""),$(".show-close").unbind("click").bind("click",function(){var e=$(this).siblings().text();t.additionArray.splice($.inArray(e,t.additionArray),1),$(this).parent().remove(),0===t.additionArray.length&&t.addBilibiliBtn.siblings().removeClass("btn-disable")})},indexEventInit:function(){var t=this;$("#addpic").unbind("click").bind("click",function(){$(".add-area input").attr("placeholder","请输入图片链接"),"default"!==t.nowtype?(t.addArea.show(),t.uploadPic.show()):(t.addArea.toggle(),t.uploadPic.toggle()),t.changeType("default")}),$("#addlink,#addvideo,#addbilibili").unbind("click").bind("click",function(){t.uploadPic.hide();var e=$(this).data("type");"link"===e?$(".add-area input").attr("placeholder","请输入链接"):"video"===e?$(".add-area input").attr("placeholder","请输入视频链接"):"bilibili"===e&&$(".add-area input").attr("placeholder","请输入bv号"),t.nowtype!==e?t.addArea.show():t.addArea.toggle(),t.changeType(e)}),this.addAreaBtn.unbind("click").bind("click",function(){"default"===t.nowtype?t.doParseDefaultFunc(this,t):"link"===t.nowtype?t.doParseLinkFunc(this,t):"video"===t.nowtype?t.doParseVideoFunc(this,t):"bilibili"===t.nowtype&&t.doParseBilibiliFunc(this,t)}),$("#text").bind("input propertychange",function(){var e=$(".pub.eynkqj");$(this).val()?e.removeAttr("disabled"):(e.attr("disabled",!0),e.css("background-color","rgb(255, 241, 147)"))}),$(".sc-AxjAm.bwpEWU.gsmhQy").bind("input propertychange",function(){var e=$(".sc-AxjAm.eVNRGW");$(this).val()?e.removeAttr("disabled"):e.attr("disabled",!0)});var o=$("#topic-search-downshift-input");o.autoComplete({minChars:0,source:function(e,t){e=e.toLowerCase();for(var n=allCategories,i=[],a=0;a<n.length;a++)~n[a][0].toLowerCase().indexOf(e)&&i.push(n[a]);0===i.length&&i.push(["未搜索到结果",-1,"",""]),t(i)},renderItem:function(e,t){var n=new Array;return n[0]=e[0],n[1]=e[1],-1===e[1]?'<div class="autocomplete-suggestion" data-val="'+JSON.stringify(n).replace(/"/g,"'")+'" disabled><div class="sc-AxjAm oDrAC" disabled>'+e[0]+"</div></div>":'<div class="autocomplete-suggestion" data-val="'+JSON.stringify(n).replace(/"/g,"'")+'"><img src="'+e[2]+'" class="sc-AxjAm gLHjJQ"><div class="sc-AxjAm oDrAC">'+e[0]+"</div></div>"},onSelect:function(e,t,n){t=t.replace(/'/g,'"');var i=JSON.parse(t),a=i[1],t=$("#category");if(-1===a)return $("#topic-search-downshift-input").val(""),void t.val(1);o.val(i[0]),t.val(a)}}),$(".post-content-inner-link a").click(function(e){e.stopPropagation()})},searchEventInit:function(){var e=$(".search-block-icon"),t=$("#search-block");e.unbind("click").bind("click",function(){"none"===t.css("display")?t.slideDown():$(".search-block").slideUp()}),$(".close").unbind("click").bind("click",function(){$(".search-block").slideUp()})},login_ajax:function(){var i=this,a=$("#login-submit"),o=$("#navbar-login-user"),s=$("#navbar-login-password");function r(){a.attr("disabled",!0).fadeTo("",1)}function l(){a.attr("disabled",!1).fadeTo("",1)}this.canLogin=!0,$("#Login_form").submit(function(){if(i.canLogin){i.canLogin=!1;var t=this;if($(this).hasClass("banLogin"))return location.reload(),!1;a.attr("disabled",!0).fadeTo("slow",.5);var n=o.val(),e=s.val();return""===n?(i.canLogin=!0,$.message({title:"登录通知",message:"必须填写用户名",type:"warning"}),o.focus(),r()):""===e?(i.canLogin=!0,$.message({title:"登录通知",message:"请填写密码",type:"warning"}),s.focus(),r()):(a.addClass("active"),$("#spin-login").addClass("show inline"),$.post(gconf.oneaction,{type:"getsecurl",url:window.location.href},function(e){$("#Login_form").attr("action",e),$.ajax({url:e,type:$(t).attr("method"),data:$(t).serializeArray(),error:function(){return i.canLogin=!0,$.message({title:"登录通知",message:"提交出错",type:"error"}),l()},success:function(e){e=$.parseHTML(e),a.removeClass("active"),$("#spin-login").removeClass("show inline");try{if($("#Logged-in",e).length<=0)return i.canLogin=!0,l(),$.message({title:"登录通知",message:"用户名或者密码错误，请重试",type:"error"});r(),e=$("#easyLogin",e).html(),$("#easyLogin").html(e),$.message({title:"登录通知",message:'登录成功:&nbsp;<a onclick="location.reload();">点击这里刷新页面，或等待自动刷新</a>',type:"success"}),i.canLogin=!0,i.loginUserName=n,setTimeout(function(){location.reload()},500)}catch(e){alert("按下F12，查看输出错误信息"),i.canLogin=!0}}})})),!1}})},loginBan:function(){var e=$("#Login_form");e.hasClass("banLogin")||(e.addClass("banLogin"),$("#navbar-login-user").attr("disabled","disabled"),$("#navbar-login-password").attr("disabled","disabled"))},resetLoginAction:function(t){0<userId||$.post(gconf.oneaction,{type:"getsecurl",url:window.location.href},function(e){$("#Login_form").attr("action",e),t()})},articleClickInit:function(){$.support.pjax&&$("article[do-pjax]").unbind().bind("click",function(e){var t=$(this).data("url");"IMG"===e.target.tagName||$.pjax({url:t,container:"#pjax-container"})}),$(".content-action").each(function(t,e){$(e).find(".btn-like").on("click",function(e){return $(this).get(0).disabled=!0,$.ajax({url:$(this).data("link"),type:"post",data:"agree="+$(this).attr("data-cid"),async:!0,timeout:3e4,cache:!1,success:function(e){/\d/.test(e)&&$($(".btn-like").find("span.agree-num")[t]).html(e)},error:function(){$(this).get(0).disabled=!1}}),e.stopPropagation(),!1})})},asideEventInit:function(){var e=$(".aside-btn"),t=$("#aside"),n=$("footer");e.unbind("click").bind("click",function(){t.hasClass("off-screen")?(t.removeClass("off-screen"),n.show()):(t.addClass("off-screen"),n.hide())}),$(".off-screen-toggle").unbind("click").bind("click",function(){$("#aside").toggleClass("off-screen")}),$("#aside .nav-menu").unbind("click").bind("click",function(){$("#aside").toggleClass("off-screen")})},pjax_complete:function(){this.init()}},archiveInit={init:function(){this.funcInit()},funcInit:function(){this.archiveEventInit(),this.commentInit(),this.fansFuncInit(),this.circleFuncInit(),this.repostFuncInit(),this.archAuthorTabShowInit(),this.archAuthorTabsClickInit(),this.iasInit(),this.lazyloadInit()},postRepostArticle:function(e,t,n,i,a,o){if(userId<0)return $.message({title:"提示",message:"请登录后操作",type:"error"}),!1;postArticle({title:indexInput.loginUserName+"转发了"+a.substring(0,20),text:'[repost href="'+e+'" bannerimg="'+n+'" repousername="'+i+'" repostext="'+a+"\" category='"+o+"']","fields[articleType]":"repost","fields[excerpt]":t,markdown:1,"category[]":1,visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!1)},repostFuncInit:function(){var r=$("#repostComment");$(".share-btn").unbind("click").bind("click",function(e){$("#repostModal").modal("show"),$("#repostModal").on("shown.bs.modal",function(){r.focus()})}),$("#repostBtn").unbind("click").bind("click",function(e){var t=r.val(),n=r.data("posthref"),i=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,a=$(".article-content").html().match(/<img.*?(?:>|\/>)/i),o="";a&&0<a.length&&((s=a[0].match(i))&&0<s.length&&(o=s[1]));a=o.match(i);a&&0<a.length&&(o=a[1]);var s=r.data("username"),i=r.data("excerpt"),a=r.data("category");"undefine"===i&&(i=""),archiveInit.postRepostArticle(n,t,o,s,i,a),$("#repostModal").modal("hide")}),$(".repost-row a").unbind("cilck").bind("click",function(e){var t=$(this).attr("href");$.pjax({url:t,container:"#pjax-container"}),e.stopPropagation()})},postFansArticle:function(n,i,a,o){$.post(gconf.oneaction,{type:"getfocusmid"},function(e){var t;e?(t=parseInt(e),postArticle({title:indexInput.loginUserName+"关注了圈友"+a,text:'[focususer href="'+n+'" avatar="'+i+'" username="'+a+'" sign="'+o+'" ]',"fields[articleType]":"focususer","fields[excerpt]":"关注了圈友"+a,markdown:1,"category[]":t,visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!1)):console.log(e)})},fansFuncInit:function(){var e=$(".fan-event"),r=this;e.unbind("click").bind("click",function(e){var t,o,s;0<userId?(t=parseInt($(this).data("authorid")),o="关注"===$.trim($(this).text())?"follow":"unfollow",parseInt(userId)!==t?($(this).attr("disabled",!0),s=this,$.post(gconf.index,{followuser:1,follow:o,uid:userId,fid:t},function(e){var t,n,i,a;e&&("unfollow"===o?($(s).text("关注"),$(s).addClass("fans"),$(s).removeClass("fansed")):($(s).text("已关注"),$(s).addClass("fansed"),$(s).removeClass("fans"),Math.random()<=.3&&(a=$(s).attr("data-author_page")?(t=$(s).parent().siblings().data("authorhref"),n=$(".author-avatar").attr("src"),i=$(".author_page-name").text(),$(".author-sign").text()):(t=(a=$(s).parent().siblings()).attr("href"),n=a.children("img").attr("src"),i=a.children("div").children(".oDrAC").text(),a.children("div").children(".ezzhLs").text()),r.postFansArticle(t,n,i,a)))),$(s).attr("disabled",!1)})):$.message({title:"提示",message:"自己不能关注自己！",type:"warning"})):$.message({title:"提示",message:"没有登录！",type:"warning"})})},circleFuncInit:function(){$(".circle-event").unbind("click").bind("click",function(e){var t,n,i;0<userId?(t=parseInt($(this).data("categoryid")),n="加入"===$.trim($(this).text())?"follow":"unfollow",$(this).attr("disabled",!0),i=this,$.post(gconf.index,{followcircle:1,follow:n,uid:userId,mid:t},function(e){e&&("unfollow"===n?($(i).text("加入"),$(i).addClass("fans"),$(i).removeClass("fansed")):($(i).text("已加入"),$(i).addClass("fansed"),$(i).removeClass("fans"))),$(i).attr("disabled",!1)})):$.message({title:"提示",message:"没有登录！",type:"warning"})})},archAuthorTabShowInit:function(){var n=$(".react-tabs__tab-list"),i=n.find("li:first-child");0<n.length&&setTimeout(function(){var e=n.first().offset().left,t=i.first().offset().left-e,e=$(".line");e.css({transform:"translateX("+t+"px)"}),e.show()},100)},archiveLoadRebindInit:function(){archiveInit.fansFuncInit(),indexInput.articleClickInit(),archiveInit.lazyloadInit()},archAuthorTabsClickInit:function(){var a,o,e=$(".react-tabs__tab-list");0<e.length&&(a=e.first().offset().left,o=$(".line"),e.children().each(function(e,n){$(n).click(function(e){var i=$(n).data("tabindex");$(this).addClass("react-tabs__tab--selected").siblings().removeClass("react-tabs__tab--selected"),o.width($(n).width());var t=$(n).offset().left-a;o.css({transform:"translateX("+t+"px)"}),$.ajax({url:"?tabindex="+i,method:"get",success:function(e){var t=$.parseHTML(e);try{var n=$(".item-container",t);if(n.length<=0)return $.message({title:"通知",message:"服务器返回错误，请重试",type:"error"});n=n.html();$(".pagination",t).length<=0&&(1===i||2===i)?$(".pagination").css("display","none"):0<$(".pagination",t).length&&(1===i||2===i)&&$(".pagination").css("display","flex"),$(".item-container").html(n);n=$(".archive-content");n.removeClass(function(e,t){return(t.match(/(^|\s)tabindex-\S+/g)||[]).join("")}),n.addClass("tabindex-"+i),archiveInit.archiveLoadRebindInit()}catch(e){console.log(e)}}})})}))},archiveEventInit:function(){$("#agree-btn").on("click",function(){$(this).get(0).disabled=!0,$(this).children().css("fill","rgb(228, 88, 62)"),$.ajax({url:gconf.index,type:"post",data:"agree="+$(this).attr("data-cid"),async:!0,timeout:3e4,cache:!1,success:function(e){/\d/.test(e)&&$(".agree-num").html(e)},error:function(){$(this).get(0).disabled=!1}})})},commentInit:function(){var t=$("html,body"),n=".comment-list",i=".comment-num",a=".comment-reply a",o="",s="";c();var r=$("#comment-form"),l=$(".submit.btn.comment-submit");function c(){$(a).click(function(){s=$(this).parent().parent().parent().attr("id")}),$("#cancel-comment-reply-link").click(function(){s=""})}l.unbind("click").bind("click",function(e){$(this).attr("disabled",!0),r.submit()}),r.submit(function(){var e=$(this).serializeArray();return""===$.trim(e[0].value)?($.message({title:"提示",message:"请输入内容",type:"error"}),l.attr("disabled",!1)):$.ajax({url:$(this).attr("action"),type:"post",data:$(this).serializeArray(),error:function(){return alert("提交失败，请检查网络并重试或者联系管理员。"),l.attr("disabled",!1),!1},success:function(e){if(l.attr("disabled",!1),!$(n,e).length)return alert("您输入的内容不符合规则或者回复太频繁，请修改内容或者稍等片刻。"),!1;o=$(n,e).html().match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort(function(e,t){return e-t}).pop(),$(".page-navigator .prev").length&&""==s&&(o=""),s?(e=$("#comment-"+o,e).hide(),$("#"+s).find(".comment-children").length<=0&&$("#"+s).append("<div class='comment-children'><ol class='comment-list'></ol></div>"),o&&$("#"+s+" .comment-children .comment-list").prepend(e),s=""):(e=$("#comment-"+o,e).hide(),$(n).length||$(".comment-detail").prepend("<h2 class='comment-num'>0 条评论</h2><ol class='comment-list'></ol>"),$(n).prepend(e)),$("#comment-"+o).fadeIn(),$(i).length&&(e=parseInt($(i).text().match(/\d+/)),$(i).html($(i).html().replace(e,e+1))),TypechoComment.cancelReply(),$("#textarea").val(""),$(a+", #cancel-comment-reply-link").unbind("click"),c(),o?t.animate({scrollTop:$("#comment-"+o).offset().top-50},300):t.animate({scrollTop:$("#comments").offset().top-50},300)}}),!1})},lazyloadInit:function(){},iasInit:function(){var i=$(".a-pageLink .next");0<i.length||i.attr("style","display:none"),i.unbind("click").bind("click",function(){var e=$(this).attr("href"),n=$(".a-pageLink .donut");return void 0!==e&&$.ajax({url:e,type:"get",beforeSend:function(){i.hide(),n.fadeIn()},error:function(e){},success:function(e){var t=$(e).find(".post-article");n.hide(),$(".list").append(t).fadeIn();e=$(e).find(".a-pageLink .next").attr("href");void 0!==e?(i.attr("href",e),i.fadeIn()):(i.attr("style","display:none"),$(".a-pageLink").append('<a href="javascript:;" rel="nofollow">加载完毕</a>')),archiveInit.archiveLoadRebindInit()}}),!1});var a=$(".a-pageLink .comments-next");0<a.length||a.attr("style","display:none"),a.unbind("click").bind("click",function(){var e=$(this).attr("href"),n=$(".a-pageLink .donut");return void 0!==e&&$.ajax({url:e,type:"get",beforeSend:function(){a.hide(),n.fadeIn()},error:function(e){},success:function(e){var t=$(e).find(".comment-list-item");n.hide(),$(".comment-detail>.comment-list").append(t).fadeIn();e=$(e).find(".a-pageLink .comments-next").attr("href");void 0!==e?(a.attr("href",e),a.fadeIn()):(a.attr("style","display:none"),$(".a-pageLink").append('<a href="javascript:;" rel="nofollow">加载完毕</a>'))}}),!1})},pjax_complete:function(){this.archiveEventInit(),this.commentInit(),this.repostFuncInit(),this.archAuthorTabShowInit(),this.iasInit(),this.lazyloadInit()}},recommendInit={init:function(){this.autoDirayWith()},autoDirayWith:function(){for(var e=document.getElementsByClassName("circle-diary-bg"),t=0;t<e.length;t++)e[t].style.height=e[t].offsetWidth+"px"},pjax_complete:function(){this.autoDirayWith()}},tagsManageInit={init:function(){this.circleEditBtn()},circleEditBtn:function(){var e=$(".circle-item .edit-btn button"),t=$("#circle-edit-save"),n=-1;e.unbind("click").bind("click",function(e){n=parseInt($(this).data("categoryid"));var t=$(this).data("name");$("#selectCircle").val(t),$("#changeCatagModal").modal("show")}),t.unbind("click").bind("click",function(e){var t;0<!n||(t=$("#changeCircle").val(),$.ajax({data:{url:gconf.index,changeCircleCat:1,mid:n,changetomid:t},method:"POST",success:function(e){"success"===e&&$.message({title:"通知",message:"更改成功，刷新后可见",type:"info"}),$("#changeCatagModal").modal("hide")},error:function(e){console.log(e),$("#changeCatagModal").modal("hide")}}))})},pjax_complete:function(){this.circleEditBtn()}},oneMap={AMapUrl:"https://webapi.amap.com/loader.js",init:function(e){if(!e)return!1;this.AMap=e,this.autoCompleteInit(e),this.geolocationInit(e),this.mapContainerInit(e,this.geolocation)},pjax_complete:function(){oneMap.AMap?(oneMap.autoCompleteInit(oneMap.AMap),oneMap.mapContainerInit(oneMap.AMap,oneMap.geolocation)):$.getScript(oneMap.AMapUrl,function(){oneMap.amapLoadInit()}),this.restoreFromLocal()},amapLoadInit:function(){var t=new XMLHttpRequest;t.open("POST",gconf.oneaction,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("type=amapKey"),t.onreadystatechange=function(){var e;4===t.readyState&&200===t.status&&(e=t.responseText,(e=JSON.parse(e)).status?(localStorage.setItem("amapkey",e.data),AMapLoader.load({key:e.data.jskey,version:"1.4.15",plugins:["AMap.Autocomplete","AMap.Geolocation","AMap.Geocoder","AMap.Marker"]}).then(function(e){oneMap.init(e)}).catch(function(e){console.error(e),$.message({type:"error",title:"提示",message:"获取amapJsKey失败"})})):$.message({type:"error",title:"提示",message:"获取amapJsKey失败"}))}},restoreFromLocal:function(){var e,t,n=localStorage.getItem("address");n&&(n=JSON.parse(n),(e=document.getElementById("ad-address"))&&((t=document.getElementById("address-input")).value=n.name,t.style.width="fit-content",document.getElementById("ad-name").value=n.name,document.getElementById("ad-district").value=n.district,e.value=n.address))},save2local:function(e,t,n){n=JSON.stringify({name:e,district:t,address:n});localStorage.setItem("address",n)},geolocationInit:function(i){var e=new i.Geolocation({enableHighAccuracy:!0,position:"RB",buttonOffset:new i.Pixel(10,20),zoomToAccuracy:!0,getCityWhenFail:!0,needAddress:!0});(this.geolocation=e).getCurrentPosition(function(e,t){var n;"complete"===e?!t.status||(n=document.getElementById("address-input"))&&(new i.Autocomplete).search(t.formattedAddress,function(e,t){0<t.count&&(n.value=t.tips[0].name,n.style.width="fit-content",document.getElementById("ad-name").value=t.tips[0].name,document.getElementById("ad-district").value=t.tips[0].district,document.getElementById("ad-address").value=t.tips[0].address,oneMap.save2local(t.tips[0].name,t.tips[0].district,t.tips[0].address))}):$.message({title:"定位失败",message:"失败原因排查信息:"+t.message,type:"error"})})},autoCompleteInit:function(e){var t=document.getElementById("ad-name");t&&(this.autoComplete=new e.Autocomplete({city:"全国",input:"address-input"}),this.autoComplete.on("select",function(e){t.value=e.poi.name,document.getElementById("ad-district").value=e.poi.district,document.getElementById("ad-address").value=e.poi.address,oneMap.save2local(e.poi.name,e.poi.district,e.poi.address)}))},mapContainerInit:function(e,t){var n,i;this.geocoder&&this.marker||(this.geocoder=new e.Geocoder({}),this.marker=new e.Marker),document.getElementById("amap-container")&&(n=new e.Map("amap-container",{resizeEnable:!0,zoom:15,mapStyle:"amap://styles/fresh"}),(e=utils.getQueryString("name"))?(i=this.marker,this.geocoder.getLocation(district+e,function(e,t){"complete"===e&&t.geocodes.length?(t=t.geocodes[0].location,i.setPosition(t),n.add(i),n.setFitView(i)):console.error("根据地址查询位置失败")})):n.addControl(t))}},utils={getQueryString:function(e){e=e.replace(/[]/,"[").replace(/[]/,"[").replace(/[]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.parent.location.href);return null==e?"":decodeURI(e[1])}};$(function(){$(window).unbind("scroll").bind("scroll",function(){var e=$(window).scrollTop(),t=$(".back-to-top");400<e?(t.addClass("animate__fadeInDown"),t.css("display","block")):t.css("display","none")}),$(".back-to-top").unbind("click").bind("click",function(){$("body,html").animate({scrollTop:0},600)}),indexInput.init(),tagsManageInit.init(),recommendInit.init(),archiveInit.init()});var pjaxInit=function(){indexInput.pjax_complete(),archiveInit.init(),recommendInit.pjax_complete(),owoInit(),tagsManageInit.pjax_complete(),oneMap.pjax_complete(),$("article.post")&&Prism.highlightAll()};function postArticle(t,n){$.post(gconf.oneaction,{type:"getsecuritytoken"},function(e){"error"!==e&&$.ajax({url:gconf.index+"/action/contents-post-edit?do=publish&_="+e,type:"post",data:t,success:function(e){n&&setTimeout(function(){$.pjax.reload("#pjax-container",{container:"#pjax-container",fragment:"#pjax-container",timeout:8e3}),$.message({title:"提示",message:"发布成功，没出来的话就刷新一下吧",type:"success"})},800)},error:function(e){return $.message({title:"提示",message:"code:"+e.status+"err:"+e.responseText+e,type:"error"})}})})}function submitForm(e){var t=$(e);t.val("发送中...");var n=$("#post-title"),i=$("#text").val(),e=new Date,e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();if(0<i.length&&""!==i&&n.val(i.substring(0,25)),"default"===indexInput.nowtype)0!==i.length&&""!==i||n.val("图文小记事~"+e),1===indexInput.additionArray.length?(i+="\n\n",indexInput.additionArray.forEach(function(e){i=i+"![]("+e+")"}),i+="\n\n"):1<indexInput.additionArray.length&&(i+="\n[gallery]",indexInput.additionArray.forEach(function(e){i=i+"![]("+e+")"}),i+="[endgallery]\n");else if("link"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),t.val("发送"),!1;0<indexInput.additionArray[1].length&&""!==indexInput.additionArray[1]?n.val(indexInput.additionArray[1].substring(0,15)):n.val("分享一个链接~"+e),i=i?'[pureLink comment="'+i+'..." text="'+indexInput.additionArray[1]+'" link="'+indexInput.additionArray[0]+'"]':'[pureLink comment="'+indexInput.additionArray[1].substring(0,60)+'..." text="'+indexInput.additionArray[1]+'" link="'+indexInput.additionArray[0]+'"]'}else if("video"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),t.val("发送"),!1;0!==i.length&&""!==i||n.val("分享视频~"+e),indexInput.additionArray.forEach(function(e){i=i+'\n[video src="'+e+'"]\n'})}else if("bilibili"===indexInput.nowtype){if(!(0<indexInput.additionArray.length))return $.message({title:"提示",message:"请输入正确链接",type:"warning"}),t.val("发送"),!1;0!==i.length&&""!==i||n.val("分享bilibili视频~"+e),indexInput.additionArray.forEach(function(e){i=i+'\n[bilibili bv="'+e+'" p="1"]\n'})}return 0===i.length||""===i?($.message({title:"提示",message:"要不输入点东西吧~",type:"warning"}),t.val("发送")):postArticle({title:n.val(),text:i,"fields[articleType]":indexInput.nowtype,markdown:1,"category[]":$("#category").val(),name:$("#ad-name").val(),district:$("#ad-district").val(),address:$("#ad-address").val(),visibility:"publish",allowComment:1,allowPing:1,allowFeed:1,do:"publish"},!0),!1}function del_article(e,t){e=$(e).attr("href");return!0===confirm("您真的确定要删除吗？")&&$.ajax({url:e,method:"post",success:function(e){$.message({title:"提示",message:"删除成功！",type:"info"})},error:function(e){$.message({title:"提示",message:"删除成功！",type:"info"})}}),!1}function videoToggle(e,t,n){return $(t).hasClass("video-slim")?($(t).children().children("span:first-child").html('<svg class="bi bi-arrows-angle-contract" width=".7em" height=".7em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" d="M9.5 2.036a.5.5 0 0 1 .5.5v3.5h3.5a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5z"/>\n  <path fill-rule="evenodd" d="M14.354 1.646a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 1 1-.708-.708l4.5-4.5a.5.5 0 0 1 .708 0zm-7.5 7.5a.5.5 0 0 1 0 .708l-4.5 4.5a.5.5 0 0 1-.708-.708l4.5-4.5a.5.5 0 0 1 .708 0z"/>\n  <path fill-rule="evenodd" d="M2.036 9.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V10h-3.5a.5.5 0 0 1-.5-.5z"/>\n</svg>'),$(t).children().children("span:last-child").text("收缩"),$(t).removeClass("video-slim")):($(t).children().children("span:first-child").html('<svg width=".7em" height=".7em" viewBox="0 0 16 16" class="bi bi-arrows-angle-expand" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707z"/>\n</svg>'),$(t).children().children("span:last-child").text("展开"),$(t).addClass("video-slim")),$(e).collapse("toggle"),n.stopPropagation(),!1}function checkURL(e){return!0===new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(e)}